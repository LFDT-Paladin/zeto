# Zeto toolkit golang library

Golang implementation of Sparse Merkle Tree that is optimized for managing an append-only tree, and is able to generate proofs to be used as private inputs to a circom-based proof generator. The project also includes an end-to-end integration test that demonstrates how to use the go-rapidsnark library to generate zkSNARK proofs with WASM based circuit runtimes.

## Prerequisites

This library requires Go version **1.23**.

## Running the unit tests for the Spark Merkle Tree implementation

```console
$ make
```

## Running the integration test

The project does NOT contain some of the cryptographic materials to perform proof generations and verifications, such as the proving keys and the verification keys. You must run the [build steps](/zkp/js/README.md#build) before you can run the tests.

> You do NOT need to re-compile the circuits. Start with the step to [Generate the proving key](/zkp/js/README.md#compile-the-circuits-and-generate-verification-keys-and-solidity-libraries).

Once the proving keys and verification keys are generated, set the following environment variables

- `CIRCUITS_ROOT`: the folder that contains the WASM runtime for the circuits that are generated by the circom compiler. If you do not want to compile the circtuis yourself, a copy of them are included in the `js/lib` folder
- `PROVING_KEYS_ROOT`: the folder that contains the proving keys and verification keys

Note: you need to be running a postgres database locally before running the tests, you can run it in Docker with:

```console
docker run -d --name postgres -e POSTGRES_PASSWORD=my-secret -p 5432:5432 postgres
```

```console
$ make e2e
```

## Running the Ethereum integration test

The `eth_e2e_test.go` file contains integration tests for interacting with Ethereum networks and Zeto contracts using the Go SDK.

### Environment Variables

The test suite supports the following environment variables:

#### Required
- `ZETO_CONTRACT_ADDRESS`: Address of the deployed Zeto contract

#### Optional
- `ETH_RPC_URL`: JSON RPC endpoint URL (default: `http://localhost:8545`)
- `ETH_PRIVATE_KEY`: ECDSA private key for signing transactions (default: hardcoded test key)
- `IS_QURRENCY_CONTRACT`: is the target token contract is Zeto_AnonNullifierQurrency (default: false)
- `NUM_RUNS`: how many iterations to run the mint/transfer cycle (default: 10)

### Running the Tests

#### Prerequisites
1. Ensure your Ethereum node (e.g., local Besu) is running
2. Deploy a Zeto contract, using the hardhat scripts in the `solidity` folder, and note its address
3. Set the required environment variables

#### Example Commands

```bash
# Set environment variables
export ETH_RPC_URL="http://localhost:8545"
export ZETO_CONTRACT_ADDRESS="0x68B1D87F95878fE05B998F19b66F4baba5De1aed"
export ETH_PRIVATE_KEY="0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"

# Run all Ethereum tests
go test -v ./integration-test/eth_e2e -run TestEthE2ETestSuite
```
